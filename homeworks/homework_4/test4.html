<!DOCTYPE html>
<html>
<head>
    <title>Final Projects</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
    integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
    integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
    crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.Default.css" />
    
</head>
<link rel="stylesheet" href="./style.css">
<script src="data/smallest.js"></script>

<style>
    .slidecontainer {
        width: 60%;
        margin: auto;
        text-align: center;
    }

    .slider {
        -webkit-appearance: none;
        width: 100%;
        height: 15px;
        background: #d3d3d3;
        outline: none;
        opacity: 0.9;
        -webkit-transition: .2s;
        transition: opacity .1s;
    }

    .slider:hover {
        opacity: 1;
    }

    .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 25px;
        height: 25px;
        background: #91a1e9;
        cursor: pointer;
    }

    .slider::-moz-range-thumb {
        width: 25px;
        height: 25px;
        background: #91a1e9;
        cursor: pointer;
    }
</style>



<body>
    <h1>Heatmap of Incidents within Lebanon During The Lebanese Civil War (1975-1989)</h1>
    <div class="slidecontainer">
        <input type="range" min="1975" max="1989" value="1975" class="slider" id="yearRange2">
        <h3>Year: <span id="yearDisplay2">1975</span></h3>
    </div>
    <div id="mapid2"></div>
    <script src="data/smallest.js"></script>

<script>
    var map2 = L.map('mapid2').setView([33.8547, 35.8623], 8); 

    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        subdomains: 'abcd',
        maxZoom: 20
    }).addTo(map2);

    var desiredCountries = ["Lebanon"];
    var startDate = new Date(1975, 0, 1); 
    var endDate = new Date(1989, 11, 31); 
    var filteredFeatures = smallest.features.filter(function(feature) {
        var featureDate = new Date(feature.properties.Year, feature.properties.Month - 1, feature.properties.Day);
        return desiredCountries.includes(feature.properties.country_name) &&
            featureDate >= startDate && featureDate <= endDate;
    });

    // Extract coordinates from filtered features
    var incidents2 = [];
    filteredFeatures.forEach(function(feature) {
        if (feature.geometry && feature.geometry.coordinates) {
            var coordinates = feature.geometry.coordinates;
            var latLng = L.latLng(coordinates[1], coordinates[0]);
            incidents2.push(latLng);
        }
    });

    // Create initial heatmap layer
    var heat2 = L.heatLayer(incidents2, {
        radius: 55,
        blur: 15,
        maxZoom: 17,
        gradient: { 0.1: 'blue', 0.2: 'cyan', 0.3: 'lime', 0.4: 'yellow', 0.6: 'orange', .9: 'red' }
    }).addTo(map2);

    var slider2 = document.getElementById("yearRange2");
    var output2 = document.getElementById("yearDisplay2");

    slider2.oninput = function() {
        updateMap(this.value);
    };

    updateMap(slider2.value);

    function updateMap(year){
        // Filter features based on selected year
        var filteredFeatures = smallest.features.filter(function(feature) {
            var featureDate = new Date(feature.properties.Year, feature.properties.Month - 1, feature.properties.Day);
            return desiredCountries.includes(feature.properties.country_name) &&
                featureDate.getFullYear() == year;
        });

        // Extract coordinates from filtered features
        var newIncidents2 = [];
        filteredFeatures.forEach(function(feature) {
            if (feature.geometry && feature.geometry.coordinates) {
                var coordinates = feature.geometry.coordinates;
                var latLng = L.latLng(coordinates[1], coordinates[0]);
                newIncidents2.push(latLng);
            }
        });

        // Update heatmap layer with new data
        heat2.setLatLngs(newIncidents2);

        // Update year display
        output2.textContent = year;
    }
</script>
</body>
</html>
