<html>
<body style="background-color:rgb(240, 235, 235);"></body>
<head>
        <title>Homework Seven!</title>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
        integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
        crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
        integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
        crossorigin=""></script>
        <script src="data/smallest.js" ></script> 
</head>
<style>
    .slidecontainer {
    width: 60%;
    }

    .slider {
    -webkit-appearance: none;
    width: 25%;
    height: 25px;
    background: #d3d3d3;
    outline: none;
    opacity: 0.9;
    -webkit-transition: .2s;
    transition: opacity .1s;
    }

    .slider:hover {
    opacity: 1;
    }

    .slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 25px;
    height: 25px;
    background: #d891d5;
    cursor: pointer;
    }

    .slider::-moz-range-thumb {
    width: 25px;
    height: 25px;
    background: #e09de0;
    cursor: pointer;
    }
    
    #mapid{ width: 100%; height: 500px; }

    h1 {
        text-align: center;
        color:palevioletred;
        font-size: xx-large;
     }
    h3 {
        color:palevioletred;
        font-size: x-large;
    }
    </style>

    <body>
    <h1>Terrorist Attacks From 1970 to 1999</h1>
    <div class="slidecontainer">
        <input type="range" min="1970" max="1999" value="1970" class="slider" id="yearRange">
         <h3>Year: <span id="yearDisplay"></span></h3>
    </div>

    <div id="mapid"></div>

    <script> 
    var map = L.map('mapid').setView([0,0], 2);; 

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
    
        var icons = {
            'Hostage Taking (Kidnapping)': L.icon({ iconUrl: './data/KidnappingIcon.png', iconSize: [10, 10] }),
            'Assassination': L.icon({ iconUrl: './data/AssassinationIcon.png', iconSize: [10, 10] }),
            'Bombing/Explosion': L.icon({ iconUrl: './data/BombingIcon.png', iconSize: [10, 10] }),
            'Facility/Infrastructure Attack': L.icon({ iconUrl: './data/FacilityAttackIcon.png', iconSize: [10, 10] }),
            'Armed Assault': L.icon({ iconUrl: './data/ArmedAssaultIcon.png', iconSize: [10, 10] }),
            'Hijacking': L.icon({ iconUrl: './data/HijackingIcon.png', iconSize: [10, 10] }),
            'Unknown': L.icon({ iconUrl: './data/UnknownIcon.png', iconSize: [10, 10] }),
            'Unarmed Assault': L.icon({ iconUrl: './data/UnarmedAssaultIcon.png', iconSize: [10, 10] }),
            'Hostage Taking (Barricade Incident)': L.icon({ iconUrl: './data/BarricadeIcon.png', iconSize: [10, 10] })
        };

        function getIcon(type) {
            return icons[type] || L.icon({ iconUrl: './data/UnknownIcon.png', iconSize: [10, 10] }); // Default icon if type not found
        };

        var slider = document.getElementById("yearRange");
        var output = document.getElementById("yearDisplay");

    var attackLayer;
    function updateMap(year) {
            if (attackLayer) {
                map.removeLayer(attackLayer);
            }
            var filteredFeatures = smallest.features.filter(function(feature) {
                return feature.properties.Year == year;
            });
            attackLayer = L.geoJSON(filteredFeatures, {
                pointToLayer: function(feature, latlng) {
                    var properties = feature.properties;
                    var attackType = properties['Attack_type'];
                    var icon = getIcon(attackType);
                    var marker = L.marker(latlng, { icon: icon });

                    if (properties.summary) {
                        marker.bindPopup(properties.summary);
                    }

                    return marker;
                }
            }).addTo(map);
            document.getElementById('yearDisplay').innerText = year;
        }

        var yearSlider = document.getElementById("yearRange");
        yearSlider.oninput = function() {
            updateMap(this.value);
        };

        updateMap(yearSlider.value);

        //legend
        var legend = L.control({position: 'bottomright'});
        legend.onAdd = function (map) {
        var div = L.DomUtil.create('div', 'info legend'),
        attackTypes = Object.keys(icons);

        div.innerHTML = '<h4>Attack Type Key</h4>';

        for (var i = 0; i < attackTypes.length; i++) {
            var attackType = attackTypes[i];
            div.innerHTML +=
                '<img src="' + icons[attackType].options.iconUrl + '" width="20" height="20">' + attackType + '<br>';
        }
        return div;
        };

    legend.addTo(map);

    </script>
    <h3>Data is from <a href="https://www.start.umd.edu/gtd/">Global Terrorism Database</a>, but please note, data is missing for 1993 (data was lost in an office move and the source reports the data has never been fully recovered)! Unlike many other event databases, the GTD includes systematic data on domestic as well as transnational and international terrorist incidents that have occurred during this time period and now includes more than 200,000 cases.</h3>
    </body>
    </html>